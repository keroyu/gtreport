$(function(){var a=$("#reportSN").val(),t=function(){var t=($("#tasksTable").width(),$("#tasksTable").height()),s=.4*t,t=.6*t;$("#tasksTable").prepend('<div class="text-center ajax-loader" style="height:'+t+"px; padding-top:"+s+'px; "><img src="/img/loader.gif" ></div>'),setTimeout(function(){$("#tasksTable").load("/ajax/reportTable/"+a)},800)};t(),$("#designer").focus(function(){$("#nameBox").show()}),$("input:not(#designer)").focus(function(){$("#nameBox").hide()}),$("#nameBox ul li").click(function(){var a=$(this).html(),t=$("#designer").val();""!==t?$("#designer").val(t+"、"+a):$("#designer").val(a),$("#designer").focus()}),$("#addNewTask").click(function(){var a=$("#reportSN").val();if(pjSN=$("#pjSN").val(),taskName=$("#taskName").val(),type=$("#type").val(),progress=$("#progress").val(),status=$("#status").val(),designer=$("#designer").val(),cowork=$("#cowork").val(),url=$("#url").val(),""!=pjSN&&""!=taskName&&""!=type&&""!=progress&&""!=designer){var s={reportSN:a,pjSN:pjSN,taskName:taskName,type:type,progress:progress,status:status,designer:designer,cowork:cowork,url:url};$.ajax({url:"/ajax/taskAdd",data:s,type:"POST",success:function(a){$("#addNewTask").after('<div class="text-center" id="res">'+a+"</div>"),$("#res").delay(1500).fadeOut("slow"),$("#taskName, #status, #cowork, #url").html(""),t()}})}else $("#addNewTask").after('<div class="alert text-center">必要資料未填寫完成!</div>'),$(".alert").delay(1500).fadeOut("slow")});var s=["TaskName","TaskProgress","TaskStatus","TaskDesigner","TaskCowork","TaskUrl"];$("body").on("click",".manageTask",function(){for(var a=$(this).data("task"),t=$(this).data("pj"),e=$(this).data("type"),r="<td>auto</td>",d=[],n=0;6>n;n++)d.push($("#td"+s[n]+a).html()),r+='<td><input type="text" class="md" id="edit'+s[n]+a+'" val=""></td>';for(var o=["W","P","M"],i=["網頁","平面","多媒體"],l='<select name="editTaskType'+a+'" id="editTaskType'+a+'">',n=0;3>n;n++)l+='<option value="'+o[n]+'"',e==o[n]&&(l+=" selected"),l+=">"+i[n]+"</option>";l+="</select>";var k='<tr class="text-right edit-area'+a+'"><td colspan="7"><span class="margin-rl" id="taskResponse'+a+'"></span><span>專案類型：'+l+'</span> <button class="btn xs primary editTaskBtn" data-task="'+a+'" data-pj="'+t+'" data-type="'+e+'">修改</button> <button class="btn xs danger delTaskBtn" data-task="'+a+'">刪除</button> <button class="btn xs cancelTaskBtn" data-task="'+a+'">取消</button></td></tr>';$("#task"+a).after('<tr class="pj-dt-ct edit-area'+a+'" id="edit'+a+'"></tr>'),$("#edit"+a).append(r).after(k);for(var n=0;6>n;n++)$("#edit"+s[n]+a).val(d[n]);setTimeout(function(){$("#task"+a).hide()},50)}),$("body").on("click",".editTaskBtn",function(){for(var a=$("#reportSN").val(),e=$(this).data("task"),r=$(this).data("pj"),d=$("#editTaskType"+e).val(),n=[],o=0;6>o;o++)n[s[o]]=$("#edit"+s[o]+e).val();var i={reportSN:a,taskSN:e,pjSN:r,taskName:n.TaskName,type:d,progress:n.TaskProgress,status:n.TaskStatus,designer:n.TaskDesigner,cowork:n.TaskCowork,url:n.TaskUrl};$.ajax({url:"/ajax/taskEdit",data:i,type:"POST",success:function(a){$("#taskResponse"+e).html(a),$("#res").delay(1500).fadeOut("fast"),setTimeout(t(),3e3)}})}),$("body").on("click",".cancelTaskBtn",function(){var a=$(this).data("task");$(".edit-area"+a).remove(),$("#task"+a).show()}),$("body").on("click",".delTaskBtn",function(){var a=$(this).data("task"),s=$("#editTaskName"+a).val();confirm('確定刪除專案 "'+s+'" 嗎?')&&$.ajax({url:"/ajax/taskDel",data:{sn:a},type:"POST",success:function(s){$("#taskResponse"+a).html(s),$("#res").delay(1500).fadeOut("fast"),setTimeout(t(),3e3)}})})});