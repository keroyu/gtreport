$(function(){var a=$("#reportSN").val(),t=function(){var t=($("#tasksTable").width(),$("#tasksTable").height()),e=.4*t,t=.6*t;$("#tasksTable").prepend('<div class="text-center ajax-loader" style="height:'+t+"px; padding-top:"+e+'px; "><img src="/img/loader.gif" ></div>'),setTimeout(function(){$("#tasksTable").load("/ajax/reportTable/"+a)},800)};t(),$("#designer").focus(function(){$("#nameBox").show()}),$("input:not(#designer)").focus(function(){$("#nameBox").hide()}),$("#nameBox ul li").click(function(){var a=$(this).html(),t=$("#designer").val();""!==t?$("#designer").val(t+"、"+a):$("#designer").val(a),$("#designer").focus()}),$("#addNewTask").click(function(){var a=$("#reportSN").val();if(pjSN=$("#pjSN").val(),taskName=$("#taskName").val(),type=$("#type").val(),progress=$("#progress").val(),status=$("#status").val(),designer=$("#designer").val(),cowork=$("#cowork").val(),url=$("#url").val(),""!=pjSN&&""!=taskName&&""!=type&&""!=progress&&""!=designer){var e={reportSN:a,pjSN:pjSN,taskName:taskName,type:type,progress:progress,status:status,designer:designer,cowork:cowork,url:url};$.ajax({url:"/ajax/taskQuery/add",data:e,type:"POST",success:function(a){$("#addNewTask").after('<div class="text-center" id="res">'+a+"</div>"),$("#res").delay(1500).fadeOut("slow"),$("#taskName, #status, #cowork, #url").html(""),t()}})}else $("#addNewTask").after('<div class="alert text-center">必要資料未填寫完成!</div>'),$(".alert").delay(1500).fadeOut("slow")});var e=["TaskName","TaskProgress","TaskStatus","TaskDesigner","TaskCowork","TaskUrl"];$("body").on("click",".manageTask",function(){for(var a=$(this).data("task"),t=$(this).data("pj"),s=$(this).data("type"),r="<td>auto</td>",d=[],o=0;6>o;o++)d.push($("#td"+e[o]+a).html()),r+='<td><input type="text" class="md" id="edit'+e[o]+a+'" val=""></td>';for(var n=["W","P","M"],i=["網頁","平面","多媒體"],l='<select name="editTaskType'+a+'" id="editTaskType'+a+'">',o=0;3>o;o++)l+='<option value="'+n[o]+'"',s==n[o]&&(l+=" selected"),l+=">"+i[o]+"</option>";l+="</select>";var k='<tr class="text-right edit-area'+a+'"><td colspan="7"><span class="margin-rl" id="taskResponse'+a+'"></span><span>專案類型：'+l+'</span> <button class="btn xs primary editTaskBtn" data-task="'+a+'" data-pj="'+t+'" data-type="'+s+'">修改</button> <button class="btn xs danger delTaskBtn" data-task="'+a+'">刪除</button> <button class="btn xs cancelTaskBtn" data-task="'+a+'">取消</button></td></tr>';$("#task"+a).after('<tr class="pj-dt-ct edit-area'+a+'" id="edit'+a+'"></tr>'),$("#edit"+a).append(r).after(k);for(var o=0;6>o;o++)$("#edit"+e[o]+a).val(d[o]);setTimeout(function(){$("#task"+a).hide()},50)}),$("body").on("click",".editTaskBtn",function(){for(var a=$("#reportSN").val(),s=$(this).data("task"),r=$(this).data("pj"),d=$("#editTaskType"+s).val(),o=[],n=0;6>n;n++)o[e[n]]=$("#edit"+e[n]+s).val();var i={reportSN:a,taskSN:s,pjSN:r,taskName:o.TaskName,type:d,progress:o.TaskProgress,status:o.TaskStatus,designer:o.TaskDesigner,cowork:o.TaskCowork,url:o.TaskUrl};$.ajax({url:"/ajax/taskQuery/edit",data:i,type:"POST",success:function(a){$("#taskResponse"+s).html(a),$("#res").delay(1e3).fadeOut("fast"),setTimeout(t(),3e3)}})}),$("body").on("click",".cancelTaskBtn",function(){var a=$(this).data("task");$(".edit-area"+a).remove(),$("#task"+a).show()}),$("body").on("click",".delTaskBtn",function(){var a=$(this).data("task"),e=$("#editTaskName"+a).val();console.log(a,e),confirm('確定刪除專案 "'+e+'" 嗎?')&&$.ajax({url:"/ajax/taskQuery/del",data:{taskSN:a},type:"POST",success:function(e){$("#taskResponse"+a).html(e),$("#res").delay(1e3).fadeOut("fast"),setTimeout(t(),2e3)}})})});