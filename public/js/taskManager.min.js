$(function(){var a=$("#cowork").data("names"),t=[];$.each(a,function(a,s){t.push(s)}),$("#cowork").autocomplete({source:t});var s=$("#reportSN").val(),e=function(){var a=($("#tasksTable").width(),$("#tasksTable").height()),t=.4*a,a=.6*a;$("#tasksTable").prepend('<div class="text-center ajax-loader" style="height:'+a+"px; padding-top:"+t+'px; "><img src="/img/loader.gif" ></div>'),setTimeout(function(){$("#tasksTable").load("/ajax/reportTable/"+s)},800)};e(),$("#designer").focus(function(){$("#nameBox").show()}),$("input:not(#designer)").focus(function(){$("#nameBox").hide()}),$("#nameBox ul li").click(function(){var a=$(this).html(),t=$("#designer").val();""!==t?$("#designer").val(t+"、"+a):$("#designer").val(a),$("#designer").focus()}),$("#addNewTask").click(function(){var a=$("#reportSN").val();if(pjSN=$("#pjSN").val(),taskName=$("#taskName").val(),type=$("#type").val(),progress=$("#progress").val(),status=$("#status").val(),designer=$("#designer").val(),cowork=$("#cowork").val(),url=$("#url").val(),""!=pjSN&&""!=taskName&&""!=type&&""!=progress&&""!=designer){var t={reportSN:a,pjSN:pjSN,taskName:taskName,type:type,progress:progress,status:status,designer:designer,cowork:cowork,url:url};$.ajax({url:"/ajax/taskAdd",data:t,type:"POST",success:function(a){$("#addNewTask").after('<div class="text-center" id="res">'+a+"</div>"),$("#res").delay(1500).fadeOut("slow"),$("#taskName, #status, #cowork, #url").html(""),e()}})}else $("#addNewTask").after('<div class="alert text-center">必要資料未填寫完成!</div>'),$(".alert").delay(1500).fadeOut("slow")});var r=["TaskName","TaskProgress","TaskStatus","TaskDesigner","TaskCowork","TaskUrl"];$("body").on("click",".manageTask",function(){for(var a=$(this).data("task"),t=$(this).data("pj"),s=$(this).data("type"),e="<td>auto</td>",o=[],d=0;6>d;d++)o.push($("#td"+r[d]+a).html()),e+='<td><input type="text" class="md" id="edit'+r[d]+a+'" val=""></td>';for(var n=["W","P","M"],i=["網頁","平面","多媒體"],l='<select name="editTaskType'+a+'" id="editTaskType'+a+'">',d=0;3>d;d++)l+='<option value="'+n[d]+'"',s==n[d]&&(l+=" selected"),l+=">"+i[d]+"</option>";l+="</select>";var c='<tr class="text-right edit-area'+a+'"><td colspan="7"><span class="margin-rl" id="taskResponse'+a+'"></span><span>專案類型：'+l+'</span> <button class="btn xs primary editTaskBtn" data-task="'+a+'" data-pj="'+t+'" data-type="'+s+'">修改</button> <button class="btn xs danger delTaskBtn" data-task="'+a+'">刪除</button> <button class="btn xs cancelTaskBtn" data-task="'+a+'">取消</button></td></tr>';$("#task"+a).after('<tr class="pj-dt-ct edit-area'+a+'" id="edit'+a+'"></tr>'),$("#edit"+a).append(e).after(c);for(var d=0;6>d;d++)$("#edit"+r[d]+a).val(o[d]);setTimeout(function(){$("#task"+a).hide()},50)}),$("body").on("click",".editTaskBtn",function(){for(var a=$("#reportSN").val(),t=$(this).data("task"),s=$(this).data("pj"),o=$("#editTaskType"+t).val(),d=[],n=0;6>n;n++)d[r[n]]=$("#edit"+r[n]+t).val();var i={reportSN:a,taskSN:t,pjSN:s,taskName:d.TaskName,type:o,progress:d.TaskProgress,status:d.TaskStatus,designer:d.TaskDesigner,cowork:d.TaskCowork,url:d.TaskUrl};$.ajax({url:"/ajax/taskEdit",data:i,type:"POST",success:function(a){$("#taskResponse"+t).html(a),$("#res").delay(1500).fadeOut("fast"),setTimeout(e(),3e3)}})}),$("body").on("click",".cancelTaskBtn",function(){var a=$(this).data("task");$(".edit-area"+a).remove(),$("#task"+a).show()}),$("body").on("click",".delTaskBtn",function(){var a=$(this).data("task"),t=$("#editTaskName"+a).val();confirm('確定刪除專案 "'+t+'" 嗎?')&&$.ajax({url:"/ajax/taskDel",data:{sn:a},type:"POST",success:function(t){$("#taskResponse"+a).html(t),$("#res").delay(1500).fadeOut("fast"),setTimeout(e(),3e3)}})})});